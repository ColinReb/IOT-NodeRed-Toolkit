<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
        <meta http-equiv="Pragma" content="no-cache"/>
        <meta http-equiv="Expires" content="0"/>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.15/css/bootstrap-multiselect.css" rel="stylesheet"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js"></script>
        <style>
            .speech-bubble {
                background:lightgreen;
                border: solid;
                border-radius: 10px;
                font-size: 1.2rem;
                line-height: 1.3;
                margin: 10px;
                max-width:90vw;
                padding: 15px;
                position: relative;

            </style>

            <style id="ace_editor.css">.ace_br1 {border-top-left-radius : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_editor {position: relative;overflow: hidden;padding: 0;font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;box-sizing: border-box;min-width: 100%;contain: style size layout;font-variant-ligatures: no-common-ligatures;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: '';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;contain: style size layout;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {position: absolute;top: 0;left: 0;right: 0;padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {contain: strict;position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;contain: strict;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: transparent;color: inherit;z-index: 1000;opacity: 1;}.ace_composition_placeholder { color: transparent }.ace_composition_marker { border-bottom: 1px solid;position: absolute;border-radius: 0;margin-top: 1px;}[ace_nocontext=true] {transform: none!important;filter: none!important;clip-path: none!important;mask : none!important;contain: none!important;perspective: none!important;mix-blend-mode: initial!important;z-index: auto;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;height: 1000000px;contain: style size layout;}.ace_text-layer {font: inherit !important;position: absolute;height: 1000000px;width: 1000000px;contain: style size layout;}.ace_text-layer > .ace_line, .ace_text-layer > .ace_line_group {contain: style size layout;position: absolute;top: 0;left: 0;right: 0;}.ace_hidpi .ace_text-layer,.ace_hidpi .ace_gutter-layer,.ace_hidpi .ace_content,.ace_hidpi .ace_gutter {contain: strict;will-change: transform;}.ace_hidpi .ace_text-layer > .ace_line, .ace_hidpi .ace_text-layer > .ace_line_group {contain: strict;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_hasPlaceholder .ace_hidden-cursors .ace_cursor {opacity: 0;}.ace_smooth-blinking .ace_cursor {transition: opacity 0.18s;}.ace_animate-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: step-end;animation-name: blink-ace-animate;animation-iteration-count: infinite;}.ace_animate-blinking.ace_smooth-blinking .ace_cursor {animation-duration: 1000ms;animation-timing-function: ease-in-out;animation-name: blink-ace-animate-smooth;}@keyframes blink-ace-animate {from, to { opacity: 1; }60% { opacity: 0; }}@keyframes blink-ace-animate-smooth {from, to { opacity: 1; }45% { opacity: 1; }60% { opacity: 0; }85% { opacity: 0; }}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_error_bracket {position: absolute;border-bottom: 1px solid #DE5555;border-radius: 0;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;box-sizing: border-box;}.ace_line .ace_fold {box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_inline_button {border: 1px solid lightgray;display: inline-block;margin: -1px 8px;padding: 0 5px;pointer-events: auto;cursor: pointer;}.ace_inline_button:hover {border-color: gray;background: rgba(200,200,200,0.2);display: inline-block;pointer-events: auto;}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_mobile-menu {position: absolute;line-height: 1.5;border-radius: 4px;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;background: white;box-shadow: 1px 3px 2px grey;border: 1px solid #dcdcdc;color: black;}.ace_dark > .ace_mobile-menu {background: #333;color: #ccc;box-shadow: 1px 3px 2px grey;border: 1px solid #444;}.ace_mobile-button {padding: 2px;cursor: pointer;overflow: hidden;}.ace_mobile-button:hover {background-color: #eee;opacity:1;}.ace_mobile-button:active {background-color: #ddd;}.ace_placeholder {font-family: arial;transform: scale(0.9);transform-origin: left;white-space: pre;opacity: 0.7;margin: 0 10px;}
                /*# sourceURL=ace/css/ace_editor.css */</style>
        </head>
        <body onload="init()">

            <div class="container">
                <div class="row" align="center">
                    <h3>Framework to  Capture and Process Serial Port Data</h3>
                </div>
                <div class="row">
                    <div class="col-sm-7 form-group">
                        <b>Enter  Simulator websocket url </b>
                        <input  class="form-control" id="url_simulator" placeholder="ws://192.168.0.35:1880/websocket"       
                                value="ws://192.168.0.35:1880/websocket">
                    </div>
                    <div class="col-sm-4 form-group">
                        &nbsp;
                        <button id="connectbuttonsimulator" onclick='connect("simulator");' class="form-control" 
                                style="background-color:grey;color:white">connect</button>
                        </div>
                    </div><!-- row -->
                    <div class="row">
                        <div class="col-sm-7 form-group">
                            <b>Enter PC side websocket url </b>
                            <input  class="form-control" id="url_pc" placeholder="ws://127.0.0.1:1880/websocket"       
                                    value="ws://127.0.0.1:1880/websocket">
                        </div>

                        <div class="col-sm-4 form-group">
                            &nbsp;
                            <button id="connectbuttonpc" onclick='connect("pc");' class="form-control" 
                                    style="background-color:grey;color:white">connect</button>

                        </div>

                    </div><!--row-->

                    <div class="row">
                        <div class="col-sm-12 form-group" id="filedata" style="overflow:scroll;"></div>
                </div><!--row-->
                <div class="row">
                    <div class="col-sm-4 form-group">
                        Inject Data / Test File
                        <input style="background-color:mediumslateblue;color:white;" type="file" onchange="importFile(this)" class="form-control" id="">

                    </div>
                    <div class="col-sm-8 form-group">
                        <font color="red">
                        First Connect to both servers. Then  click the red "Run-Test" button.<br/>
                        The Test data will be processed by the editor code shown below.<br/>
                        Watch the section Received Messages.
                        </font>
                    </div>
                </div><!--row-->
                    <div class="row">
                        <div class="col-sm-12 form-group">
                            Note : When you load the test data file it will show up in a single row table (red border cells). Each cell contains one byte of data corresponding to the
                            file contents. <b>You can edit these bytes before you transmit</b>. In case you need to enter non-printable characters you must use the standard
                            ASCII representation like STX for Hex 02  etc. Any byte ( decimal range 0-255) can be represented in hex by 
                            <font color="red">\xHH</font> where H is a hex representation between 0-F<br/>
                            In case you need to send a fewer number of characters than the cells present you need to keep a Blank cell to indicate the data ends there.
                            Anything beyond that in the table cells will be ignored. <br/>
                            <font color=red>Note: A space char/byte Hex(0x20) should be entered in as SPC </font><br/>
                            Some popular common values in decimal[hex]:<br/>
                            <b>STX=2, ETX=3, EOT=4, ENQ=5, ACK=6, LF=10 [0A],CR=13 [0D],NAK=21[15]</b>
                            </b><br/>

                        </div>
                    </div>

                </div><!-- container  ends --->
                <hr style="height:3px;background-color:blue;"/>
                <div class="container">
                    <div >
                        <table><tr>
                                <td><h4>Received Messages &nbsp; </h4></td>
                                <td>
                                    <button style="background-color:mediumpurple;color:white;" 
                                            onclick='clearmessages()'>Clear</button>
                            </td></tr></table>
                </div>
                <div id="messagelog">
                    <div id="msgbubble" class="speech-bubble">Messages and important events  come here</div>
                </div>
            </div>
            <hr style="height:3px;background-color:blue;"/>
            <iframe id="editorframe" src="" style="width:100vw;height:100vh;"></iframe>


            <script>
                function clearmessages()
                {
                    var div = document.querySelector('#msgbubble').cloneNode(true);
                    document.querySelector("#messagelog").innerHTML = "";
                    document.querySelector('#messagelog').appendChild(div);
                }
                function newmessage(msg)
                {
                    var div = document.querySelector('#msgbubble').cloneNode(true);
                    div.innerHTML = msg;
                    document.querySelector('#messagelog').appendChild(div);
                }


                function init()
                {
                    document.querySelector("#editorframe").src = "editoriframe.html?" + (new Date()).toString();
                    var s="\x025R|2|^^^1.0000+950+1.0|15|||^5^||V||34001637|20080516153540|20080516153602|34001637\x0D\x033D\x0D\x0A";
                    displaybytestream(s);
                    setTimeout("alert('Note: Red boxed bytes are sample data. You can load from a file as well');",'500');
                    
                }


                var framedata = "";
                function importFile(input) {
                    let file = input.files[0];
                    var reader = new FileReader();
                    reader.onload = function (event) {
                        var contents = event.target.result;
                        if (contents.length > 2000)
                        {
                            alert("file too big choose a smaller file. Limit is 2000 bytes");
                            return;
                        }
                        console.log(contents.toString("utf8"));
                        //framedata = contents.toString("utf8");
                        displaybytestream(contents.toString("utf8"));
                    };
                    reader.onerror = function (event) {
                        console.error("File could not be read! Code " + event.target.error.code);
                        alert("Error:File could not be read! Code " + event.target.error.code);
                    };
                    reader.readAsBinaryString(file);
                }//import       

                var original_filedata = "";
                var specialchars = [
                    "NUL", "SOH", "STX", "ETX", "EOT", "ENQ", "ACK", "BEL",
                    "BS", "TAB ", "LF", "VT", "FF", "CR", "SO", "SI", "DLE", "DC1", "DC2", "DC3", "DC4", "NAK", "SYN",
                    "ETB", "CAN", "EM", "SUB", "ESC", "FS", "GS", "RS", "US", "SPC"];
                function displaybytestream(data)// for file import
                {
                    original_filedata = data;
                    var table = document.createElement('table');
                    table.id = "sendtable";
                    var row = document.createElement('tr');
                    var idxrow = document.createElement('tr');
                    table.appendChild(idxrow);
                    table.appendChild(row);
                    for (i = 0; i < data.length; i++)
                    {
                        var idxcell = document.createElement('td');
                        idxcell.setAttribute("cellid", i);
                        idxcell.innerText = i;
                        idxcell.style.padding = "6px";
                        idxrow.appendChild(idxcell);
                        var cell = document.createElement('td');
                        cell.setAttribute("contenteditable", "true");
                        cell.style.border = "2px solid red";
                        cell.style.padding = "6px";
                        cell.style.fontSize = "25px";
                        cell.setAttribute('idx', i.toString());
                        row.appendChild(cell);
                        var char = data.substr(i, 1);
                        var ascii = char.charCodeAt(0);
                        //console.log(ascii);
                        if (ascii < 32)
                        {
                            cell.innerText = specialchars[ascii];
                        } else if (ascii === 32)//space
                        {
                            cell.innerHTML = "SPC"; //cell
                            cell.style.minWidth = "32px";
                            cell.style.width = "32px";
                        } else if (ascii === 127)
                        {
                            cell.innerText = "DEL";
                        } else if (ascii > 127)
                        {
                            cell.innerText = "\\x" + ascii.toString(16);
                            ;
                        } else
                        {
                            cell.innerText = char;
                        }
                    }//for
                    var bsdiv = document.querySelector("#filedata");
                    bsdiv.innerHTML = "";
                    bsdiv.appendChild(table);
                }//convert2bytesstream

                function checkandsend(destination)
                {
                    var sendtable = document.querySelector('#sendtable');
                    if (sendtable === null)
                    {
                        alert("select a file containing the data to send via choose file");
                        return;
                    }
                    var datarow = sendtable.querySelectorAll('tr')[1];//end table has 2 rows the top one with the index
                    var cellarr = datarow.querySelectorAll('td');
                    var sendbuffer = [];

                    for (var i = 0; i < cellarr.length; i++)
                    {
                        cellarr[i].innerText = cellarr[i].innerText.trim(); //clean it up
                        if (cellarr[i].innerText.trim().length === 0)
                        {
                            alert("Note: Nothing specified at offset " + i + ". We assuming nothing beyond this. Note, if you want a space character then enter SPC !!! ");
                            var x=confirm("Do you want to Test-Run this with only the first " + (i) + " bytes ? ");
                            if(!x) {return;}
                            
                            break;
                        }//if
                        else if (cellarr[i].innerText.length === 1)
                        {
                            sendbuffer.push(cellarr[i].innerText.charCodeAt(0));
                        } else if (cellarr[i].innerText.startsWith("\\x"))
                        {
                            if (cellarr[i].innerText.length !== 4)
                            {
                                alert("Found=[" + cellarr[i].innerText + "], Error in data at offset " + i + ", hex digits must be of length=4 and the form \\xAA,\\x00 etc");
                                return;
                            }
                            sendbuffer.push(parseInt(cellarr[i].innerText.substr(2, 2), 16));
                        } else
                        {
                            //check if Special char
                            var s = cellarr[i].innerText.toUpperCase();
                            var found = false;
                            for (var j = 0; j < specialchars.length; j++)
                            {
                                if (s === specialchars[j])
                                {
                                    sendbuffer.push(j);
                                    found = true;
                                    break;
                                }
                            }

                            if (!found)
                            {
                                
                                alert("Error in data at offset " + i + ", must be a single character or the regular identifier eg STX, ETX etc");
                                return;
                            }
                        }
                    }//for

                    if (sendbuffer.length === 0)
                    {
                        alert("No Data to send");
                        return;
                    }
                    console.log("sending buffer");
                    console.log(sendbuffer);

                    if (destination === "local")
                    {
                        NodeObj.checksumframe(sendbuffer);//process needs an array as a string
                    } else
                    {
                        if (socketarr[destination] === undefined || socketarr[destination] === null)
                        {
                            alert("not connected to " + destination + ", Please do that first");
                            return;
                        }
                        socketarr[destination].send(sendbuffer, "process");
                    }
                }//sendtoserialport

                function parseFrameChecksum(destination)
                {

                    checkandsend(destination);
                    return;

                }


                function Editor_getNodeCode()
                {
                    return NodeObj.checksumframe.toString();
                }
                function Editor_setNodeCode(s)
                {

                    eval(" NodeObj.checksumframe=" + s);
                    console.log("browser side..installed new code ok");
                }

                var NodeObj = {
                    "checksumframe": function (data) //s is  msg.payload
                    {
                        // Note: The parameter to this function is same as Node Red function node.
                        // ie msg.payload.
                        // data must be an Array of integers[0-255] 
                        if (!Array.isArray(data))
                        {
                            console.log("Bad Data format");
                            return;
                        }
                        //------Utility functions Do not edit this Area------
                        //utility function
                        var int_array_toString = ((int_arr) => {
                            //convert an integer array to string since mostly byte arrays are flying about :)
                            var s = String.fromCharCode.apply(null, int_arr);
                            console.log(s);
                            return s;
                        }
                        );

                        //Note: Values in decimal not Hex
                        var ascii = {"STX": 2, "ETX": 3, "EOT": 4, "ENQ": 5, "ACK": 6, "LF": 10, "CR": 13, "NAK": 21};
                        ascii_payload = int_array_toString(data);

                        //-----Do not edit above area.-----------------------
                        // Start debugging here on the browser side with Chrome Dev Tools

                        // create a msg object for the reply
                        var msg = {};
                        //debugger; //optional  ..can comment out
                        if (ascii_payload.charCodeAt(0) === ascii.ENQ)
                        {
                            msg.payload = [ascii.ACK];//lets just return an array of 
                            return msg;//integers, its easier that way , we can send it direct to the serial port
                        }

                        //Do the ASTM data frame checksum
                        //// Ref:https://www.hendricksongroup.com/code_003.aspx

                        // For the code below we follow the following. Assume the data is 
                        //[STX][F#][Text][ETX][CHK1][CHK2][CR][LF]
                        //F# is frameno ( not checked but you should say saving this and comparing against next frame !!!)
                        /*
                         [CHK1][CHK2] is expressed by characters "0" - "9" and "A" - "F". Characters beginning from the character 
                         following [STX] including F# and until [ETB] or [ETX] (including [ETB] or [ETX]) are added in binary and divided by 256 , 
                         the remainder ie modulo is now a numer in the range0-255. 
                         The single 8 bit remainder result is split into 4 bits each. Each 4 bits has a range 0-15 or Hex 0-F so 
                         converted to ASCII characters "0" - "9" and "A" - "F". The most significant digit is stored in 
                         CHK1 and the least significant digit in CHK2.       
                         */

                        var sum = 0;
                        var byteval = 0;
                        for (var i = 1; i < ascii_payload.length - 4; i++)
                        {
                            sum += ascii_payload.charCodeAt(i);
                        }

                        var computed_cs = sum % 256;
                        //console.log("char c1=" + frame.substr(frame.length - 4,1));
                        var c1 = ascii_payload.charCodeAt(ascii_payload.length - 4); // ASCII character rep CHK1..convert to Decimal and get value eg A=10
                        var d1 = (c1 > 47 && c1 < 58) ? (c1 - 48) : (c1 - 55); //( Visual 0-9 is Dec 48-57) and A-F is 65-70, c1-55 to give value=10 for 65=A )
                        var c2 = ascii_payload.charCodeAt(ascii_payload.length - 3);
                        var d2 = (c2 > 47 && c2 < 58) ? (c1 - 48) : (c2 - 55);
                        var frame_cs = (d1 * 16 + d2);
                        if (computed_cs === frame_cs)
                        {
                            msg.payload = [ascii.ACK];
                            console.log("checksum matches");
                        } else
                        {
                            msg.payload = [ascii.NAK];
                            console.log("checksum does NOT !! match");
                        }
                        console.log(msg);
                        return msg;
                    }//process
                }; //var parser

                var newobj = {};
                var funcnames = [];
                var funccode = [];

                var parser1 = {
                    "checksumframe": function (data) //s is  msg.payload
                    {
                        // Some function..Details not important
                    }
                };
                function DeployToNode()
                {
                    var myobj = NodeObj;
                    funcnames = [];
                    funccode = []; // function code as a string
                    for (var name in myobj) {
                        if (myobj.hasOwnProperty(name)) {
                            if (typeof myobj[name] === 'function')
                            {
                                funcnames.push(name);
                                funccode.push(myobj[name].toString());
                            }
                        }
                    }
                    //NOTE:JSON does not support functions.
                    var sobj = JSON.stringify(myobj);
                    var seval = "";
                    seval = "var newobj=JSON.parse(\"" + sobj.replaceAll(/"/g, "\\\"") + "\" );";
                    for (var i = 0; i < funcnames.length; i++)
                    {
                        seval += "newobj." + funcnames[i] + "=" + funccode[i] + ";\n";
                    }
                    if (socketarr["pc"] === null || socketarr["pc"] === undefined)
                    {
                        alert("Not connected to PC side. Please do that");
                        return;
                    }
                    socketarr["pc"].send(seval, "install");
                }//Createobj


                var socketarr = [];

                var ws_socketobj = {
                    ws_socket: null,
                    deviceID: "",
                    create: function (url, deviceID)
                    {
                        if (this.ws_socket !== null)
                        {
                            console.log("closing the existing websocket");
                            this.ws_socket.close(); //closes the socket.if already closed..does nothing
                            this.ws_socket = null;
                            setTimeout(function () {
                                socketarr[deviceID].create(url);
                            }, 1000); //callback
                            return;
                        }

                        if (url.indexOf("ws://") !== 0)
                        {
                            url = "ws://" + url;
                        }

                        console.log(this.ws_socket);
                        this.ws_socket = new WebSocket(url);
                        this.deviceID = deviceID;

                        this.ws_socket.onopen = function () {
                            console.log(deviceID + ": onopen event");
                            document.querySelector('#connectbutton' + deviceID).style.backgroundColor = 'red';
                            document.querySelector('#connectbutton' + deviceID).innerHTML = 'Connected';
                            console.log("setting connected");
                            newmessage("<b>" + deviceID + "</b>: websocket onopen event ");
                        };

                        this.ws_socket.onclose = function () {
                            console.log(deviceID + ":onclose event");
                            newmessage("<b>" + deviceID + "</b>: websocket  onclose event ");
                            if (socketarr[deviceID] === null || socketarr[deviceID] === undefined)
                            {
                                return;
                            }
                            document.querySelector('#connectbutton' + deviceID).style.backgroundColor = 'grey';
                            document.querySelector('#connectbutton' + deviceID).innerHTML = 'connect';
                            socketarr[deviceID].ws_socket = null;
                            deviceID = "";
                        };

                        this.ws_socket.onerror = function (error) {
                            console.log(deviceID + ': *** onerror:event : ' + error);
                            console.log(deviceID + ', Error detected: ');
                            newmessage("<b>" + deviceID + "</b>: websocket onerror event ");
                            alert("error connecting to " + deviceID);
                            document.querySelector('#connectbutton' + deviceID).style.backgroundColor = 'grey';
                            document.querySelector('#connectbutton' + deviceID).innerHTML = 'connect';
                            socketarr[deviceID].ws_socket = null;
                            deviceID = "";
                        };

                        this.ws_socket.onmessage = function (e) {
                            console.log("reply by " + deviceID);
                            console.log(e.data);
                            newmessage("<b>" + deviceID + "</b>: websocket onmessage event data= " + e.data);
                            var recdmsg = null;
                            var msgobj = null;
                            if (e.data instanceof Blob)
                            {
                                (async () => {
                                    const blob = e.data;
                                    const arraybuffer = await blob.arrayBuffer();
                                    var jsonarray = (Array.from(new Uint8Array(arraybuffer)));
                                    newmessage("<b>" + deviceID + "</b>: same message as jsonarray containing integer(s) " + jsonarray);
                                    if (jsonarray.length === 1)
                                    {

                                    }
                                    console.log(jsonarray); // 5
                                })();
                                return;
                            } else
                            {
                                msgobj = JSON.parse(e.data);
                                recdmsg = e.data;
                                newmessage("<b>" + deviceID + "</b>: same message as string = " + recdmsg);
                            }
                            // parse the message

                            if (msgobj !== null && msgobj.sender === deviceID)
                            {
                                newmessage("<b>Note Echo: " + deviceID + "</b>:message event ");
                                return;
                            }


                        };
                    },

                    "send": function (msg, op)
                    {
                        if (this.deviceID === null || this.deviceID.trim().length === 0 || this.ws_socket === null)
                        {
                            alert(this.deviceID + ": not connected, please do that first");
                            return;
                        }
                        if (this.ws_socket.readyState !== WebSocket.OPEN) {
                            console.log(this.deviceID + ": Cannot send socket readystate=" + this.ws_socket.readyState);
                            return;
                        }
                        if (op.trim().length === 0) {
                            console.log(this.deviceID + ": Cannot send op not specified");
                            return;
                        }
                        var smsg = msg; // assume the message is a string
                        //if (typeof (msg) === 'object')
                        //{
                        //    smsg = JSON.stringify(msg);
                        //}

                        if (op === "install")
                        {
                            console.log(this.deviceID + `: sending code to install processor`);
                            newmessage("<b>" + this.deviceID + "</b>: send to websocket op=install code on PC");

                        } else
                        {
                            console.log(this.deviceID + `: sending message:` + smsg);
                            newmessage("<b>" + this.deviceID + "</b>:send to websocket [" + smsg + "]");


                        }
                        var sendobj = {};
                        sendobj.sender = this.deviceID;
                        sendobj.payload = smsg;
                        sendobj.op = op;
                        console.log("Sending from deviceID");
                        //console.log(sendobj);
                        // Always send messages out as strings but these are JSON objects which need to be parsed server side
                        this.ws_socket.send(JSON.stringify(sendobj));//send it via the websocket
                    }//send

                }; //ws_receiveMessage

                function connect(s)// s=simulator or pc
                {
                    console.log("Connecting to websocket");
                    var url = document.querySelector('#url_' + s).value.trim();
                    if (url.length === 0)
                    {
                        alert("error: websocket url not specified");
                        return;
                    }


                    //------do the properties that are functions---
                    var funcnames = [];
                    var funccode = []; // function code as a string
                    for (var name in ws_socketobj) {
                        if (ws_socketobj.hasOwnProperty(name)) {
                            console.log(name);
                            if (typeof ws_socketobj[name] === 'function')
                            {
                                funcnames.push(name);
                                funccode.push(ws_socketobj[name].toString());
                                console.log(funcnames);
                                console.log(funccode);
                            } else
                                console.log("not a function");
                        }
                    }
                    //======Create the new socket from the tmplate
                    var newsock = JSON.parse(JSON.stringify(ws_socketobj));
                    //======Receive part Add in the properties that are functions
                    var seval = "";
                    for (var i = 0; i < funcnames.length; i++)
                    {
                        seval += "newsock." + funcnames[i] + "=" + funccode[i] + ";\n";
                    }
                    eval(seval);
                    socketarr[s] = newsock;
                    socketarr[s].create(url, s);

                }//init_websocket


                var sendMessage = function (msg) {
                    var msg = document.querySelector('#testmessage').value;
                    socketarr['pc'].send(msg, "commtest");
                };

            </script>

        </body>
    </html>
